# 安装编译工具

1、可以用源码自带的build命令来进行一次全量编译：

```sh
./build.sh --product-name rk3568 --ccache --target-cpu=arm64
```

如果只想编译Linux内核（默认5.10），则为：

```sh
./build.sh --product-name rk3568 --ccache --target-cpu=arm64 --build-target kernel
```

2、如果想使用openharmony支持的hb命令，则需要进入到源码目录下，安装：

```sh
pipx install build/hb
```

这样会将ohos-build工具集安装到用户目录：

```sh
/home/jason/.local/pipx/venvs/ohos-build/
```

然后再建一个链接：

```sh
cd /home/jason/.local/bin/
ln -sf /home/jason/.local/pipx/venvs/ohos-build/bin/hb hb
```

这样就可以在源码目录树下使用hb了：

```sh
cd /media/jason/btrfs_disk_M/Develop/ohos/openharmony
hb help
```

如果安装正确，则会出现以下内容：

```sh
$ hb help
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb build [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --target-cpu {arm,arm64,x86_64,x64,mipsel,riscv64,loongarch64}
[OHOS INFO]                         Default:''. Help:Specifies the desired cpu architecture for the build, each may support different cpu architectures, run 'hb set --all' to list product all supported cpu architectures
[OHOS INFO]   --target-os {android,ios}
[OHOS INFO]                         Default:''. Help:Specifies the desired os type for the build, each may support different os type, run 'hb set --all' to list product all supported os type
[OHOS INFO]   -p PRODUCT_NAME, --product-name PRODUCT_NAME
[OHOS INFO]                         Default:''. Help:Build a specified product. You could use this option like this: 1.'hb build --product-name rk3568@hihope' 2.'hb build --product-name rk3568'
[OHOS INFO]   --rename-last-log [RENAME_LAST_LOG]
[OHOS INFO]                         Default:True. Help:You can use it to decide whether to keep the last build log
[OHOS INFO]   --log-mode {normal,silent}
[OHOS INFO]                         Default:'normal'. Help:You can use this option to determine whether to use single-line refresh log mode
[OHOS INFO]   --precise-branch PRECISE_BRANCH
[OHOS INFO]                         Default:'dayu200_tdd'. Help:You can use this option to select the dayu200_tdd branch
[OHOS INFO]   --ccache [CCACHE]     Default:True. Help:Enable ccache, this option could improve compilation speed. --stat-ccache can summary the cache data
[OHOS INFO]   --xcache [XCACHE]     Default:False. Help:Enable xcache, this option could improve compilation speed. --stat-ccache can summary the cache data
[OHOS INFO]   --enable-pycache [ENABLE_PYCACHE]
[OHOS INFO]                         Default:False. Help:Enable pycache, This option can improve the execution speed of python files
[OHOS INFO]   --jobs JOBS           Deprecated, please do not use this option
[OHOS INFO]   --disable-part-of-post-build [DISABLE_PART_OF_POST_BUILD ...]
[OHOS INFO]                         Deprecated, please do not use this option
[OHOS INFO]   -T [BUILD_TARGET ...], --build-target [BUILD_TARGET ...]
[OHOS INFO]                         Default:[]. Help:You use this option to specify a single compilation target, and use 'hb tool --ls' to list all build target
[OHOS INFO]   --ninja-args [NINJA_ARGS ...]
[OHOS INFO]                         Default:[]. Help:You can use it to pass parameters for the ninja phase, but you need to follow the specified command format. eg. --ninja-args=-dkeeprsp
[OHOS INFO]   -f [FULL_COMPILATION], --full-compilation [FULL_COMPILATION]
[OHOS INFO]                         Default:[]. Help:You can use it to start full code compilation. The default compilation target is images. Use this option to add 'make_all' and 'make_test' to the build process.
[OHOS INFO]   --strict-mode [STRICT_MODE]
[OHOS INFO]                         Default:False. Help:Check all produce of each phase to early terminates a potentially problematic compilation.
[OHOS INFO]   --scalable-build [SCALABLE_BUILD]
[OHOS INFO]                         Default:False. Help:Select whether to read information from parts.json generate by preload
[OHOS INFO]   --build-example [BUILD_EXAMPLE]
[OHOS INFO]                         Default:False. Help:Select whether to read information from subsystem_config_example.json
[OHOS INFO]   --build-platform-name BUILD_PLATFORM_NAME
[OHOS INFO]                         Default:'phone'. Help:Name of the compilation platform. The current optional value is 'phone'
[OHOS INFO]   --build-xts [BUILD_XTS]
[OHOS INFO]                         Default:False. Help:Select whether to load the components included in the subsystem xts
[OHOS INFO]   --ignore-api-check [IGNORE_API_CHECK ...]
[OHOS INFO]                         Default:[]. Help:Skip the check of some subsystems
[OHOS INFO]   --load-test-config [LOAD_TEST_CONFIG]
[OHOS INFO]                         Default:True. Help:Select whether to load the test field in bundle.json, that is, whether to call the test case
[OHOS INFO]   --skip-partlist-check [SKIP_PARTLIST_CHECK]
[OHOS INFO]                         Default:False. Help:Skip the subsystem and component check in partlist file
[OHOS INFO]   --build-type {release,profile,debug}
[OHOS INFO]                         Default:'release'. Help:Specify compile release or debug version
[OHOS INFO]   --log-level {info,debug}
[OHOS INFO]                         Default:'INFO'. Help:Specify the log level during compilation. you can select two levels: debug, info. In debug mode, it show all command lines while building, including cxx, link, solink, etc.
[OHOS INFO]   --export-para [EXPORT_PARA ...]
[OHOS INFO]                         Deprecated, please do not use this option
[OHOS INFO]   --test [TEST ...]     Default:[]. Help:You can use it to choose test type. eg. --test xts
[OHOS INFO]   --gn-args [GN_ARGS ...]
[OHOS INFO]                         Default:[]. Help:Specify gn build arguments, you could use this option like this 'hb build --gn-args is_debug=true'
[OHOS INFO]   --gn-flags [GN_FLAGS ...]
[OHOS INFO]                         Default:[]. Help:Specify gn build arguments, you could use this option like this 'hb build --gn-flags "--export-compile-commands"
[OHOS INFO]   -c COMPILER, --compiler COMPILER
[OHOS INFO]                         Deprecated, please do not use this option
[OHOS INFO]   --fast-rebuild [FAST_REBUILD]
[OHOS INFO]                         Default:False. Help:You can use it to skip prepare, preloader, gn_gen steps so we can enable it only when there is no change for gn related script
[OHOS INFO]   --root-perf-main {root,main,root_main}
[OHOS INFO]                         Default:root. Help:different kinds of root packages
[OHOS INFO]   --runtime-mode {release,debug,profile}
[OHOS INFO]                         Default:release. Help:runtime mode
[OHOS INFO]   --check-compilation-parameters [CHECK_COMPILATION_PARAMETERS]
[OHOS INFO]                         Default:false. Help:check compilation parameters
[OHOS INFO]   --keep-ninja-going [KEEP_NINJA_GOING]
[OHOS INFO]                         Default:False. Help:When you need to debug one specific target, you can use this option to keep ninja going to skip some possible error until 1000000 jobs fail
[OHOS INFO]   --build-only-load [BUILD_ONLY_LOAD]
[OHOS INFO]                         Default:False. Help:Stop build until load phase ends
[OHOS INFO]   --build-only-gn [BUILD_ONLY_GN]
[OHOS INFO]                         Default:False. Help:Stop build until gn phase ends
[OHOS INFO]   --build-variant {user,root}
[OHOS INFO]                         Default:'root'. Help:specifies device operating mode
[OHOS INFO]   --device-type DEVICE_TYPE
[OHOS INFO]                         Default:'default'. Help:specifies device type
[OHOS INFO]   --disable-package-image [DISABLE_PACKAGE_IMAGE]
[OHOS INFO]                         deprecated, please do not use this option
[OHOS INFO]   --archive-image [ARCHIVE_IMAGE]
[OHOS INFO]                         Default:False. Help:archive image when build product complete
[OHOS INFO]   --patch [PATCH]       Default:False. Help: Apply patches as per configuration in patch.yml, and handle rollback if needed.
[OHOS INFO]   --rom-size-statistics [ROM_SIZE_STATISTICS]
[OHOS INFO]                         Default:False. Help:statistics on the actual rom size for each compiled component
[OHOS INFO]   --stat-ccache [STAT_CCACHE]
[OHOS INFO]                         Default:True. Help:summary ccache hitrate, and generate ccache.log in ${HOME}/.ccache dir
[OHOS INFO]   --get-warning-list [GET_WARNING_LIST]
[OHOS INFO]                         Default:True. Help:You can use it to collect the build warning and generate WarningList.txt in output dir
[OHOS INFO]   --generate-ninja-trace [GENERATE_NINJA_TRACE]
[OHOS INFO]                         Default:True. Help:Count the duration of each ninja thread and generate the ninja trace file(build.trace.gz)
[OHOS INFO]   --compute-overlap-rate [COMPUTE_OVERLAP_RATE]
[OHOS INFO]                         Default:True. Help:Compute overlap rate during the post build
[OHOS INFO]   --clean-args [CLEAN_ARGS]
[OHOS INFO]                         Default:True. Help:clean all args that generated by this compilation while compilation finished
[OHOS INFO]   --deps-guard [DEPS_GUARD]
[OHOS INFO]                         Default:True. Help:simplify code, remove concise dependency analysis, and speed up rule checking
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb set [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   -p PRODUCT_NAME, --product-name PRODUCT_NAME
[OHOS INFO]                         Default:''. Help:build a specified product. You could use this option like this: 1.'hb set --product-name rk3568@hihope' 2.'hb set --product-name rk3568' 3.'hb set'[graphical ui]
[OHOS INFO]   --all [ALL]           Default:False. Help:Use a graphical interface to customize most compile-time parameters
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb env [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   -s SSHKEY, --sshkey SSHKEY
[OHOS INFO]                         Default:''. Help: set sshkey
[OHOS INFO]   -l [CLEAN], --clean [CLEAN]
[OHOS INFO]                         Default:false. Help: clean all env args
[OHOS INFO]   --check [CHECK]       Default:True. Help:check that the current running environment contains all dependencies
[OHOS INFO]   --install [INSTALL]   Default:False. Help:install all dependent software for compiling L0, L1 and L2 products
[OHOS INFO]   -i [INDEP_BUILD], --indep-build [INDEP_BUILD]
[OHOS INFO]                         Default:false. Help: switch to independent build
[OHOS INFO]   --part PART           Default:''. Help:Specify component name, run 'hb env --part {part_name}'
[OHOS INFO]   --target-cpu {arm,arm64,x86_64,x64,mipsel,riscv64,loongarch64}
[OHOS INFO]                         Default:'arm'. Help:Specifies the desired cpu architecture for the build, each may support different cpu architectures, run 'hb env --target-cpu {cpu_architectures}' to set cpu architectures
[OHOS INFO]   --target-os {android,ohos,mac,linux,windows}
[OHOS INFO]                         Default:''. Help:Specifies the desired os type for the build, each may support different os type, run 'hb env --target-os {os_type}' to set os type
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb clean [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --clean-all [CLEAN_ALL]
[OHOS INFO]                         Default:False. Help:clean all producer
[OHOS INFO]   --clean-args [CLEAN_ARGS]
[OHOS INFO]                         Default:True. Help:clean all args that generated by last compilation
[OHOS INFO]   --clean-out-product [CLEAN_OUT_PRODUCT]
[OHOS INFO]                         Default:False. Help:clean out/{product} directory that generated by last compilation
[OHOS INFO]   --clean-ccache [CLEAN_CCACHE]
[OHOS INFO]                         Default:False. Help:clean .ccache directory which is in OHOS root . WARNING, clean ccache may cause something
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb tool [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --ls [LS ...]         Default:[]. Help:Lists all targets matching the given pattern for the given build directory. You could use this option like this: 1.'hb tool --ls <out_dir> [<label_pattern>] [<options>]'
[OHOS INFO]   --desc [DESC ...]     Default:[]. Help:Displays information about a given target or config. You could use this option like this: 1.'hb tool --desc <out_dir> <component_module> [<what to show>] [<options>]'
[OHOS INFO]   --path [PATH ...]     Default:[]. Help:Finds paths of dependencies between two targets. You could use this option like this: 1.'hb tool --path <out_dir> <component1_module1> <component2_module2> [<options>]'
[OHOS INFO]   --refs [REFS ...]     Default:[]. Help:Finds reverse dependencies (which targets reference something). You could use this option like this: 1.'hb tool --refs <out_dir> [<component_module>|<file>] [<options>]'
[OHOS INFO]   --format [FORMAT ...]
[OHOS INFO]                         Default:[]. Help:Formats .gn file to a standard format. You could use this option like this: 1.'hb tool --format /abspath/some/BUILD.gn [<options>]'
[OHOS INFO]   --clean CLEAN         Default:[]. Help:Deletes the contents of the output directory except for args.gn. You could use this option like this: 1.'hb tool --clean <out_dir>'
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb indep_build [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --part PART           Default:''. Help:specify component name, run 'hb build {part_name} or hb build --part {part_name}'
[OHOS INFO]   --target-cpu {arm,arm64,x86_64,x64,mipsel,riscv64,loongarch64}
[OHOS INFO]                         Default:''. Help:Specifies the desired cpu architecture for the build, each may support different cpu architectures, run 'hb build --target-cpu {cpu_architectures}' to set os type cpu architectures
[OHOS INFO]   --target-os {android,ohos,mac,linux,windows}
[OHOS INFO]                         Default:''. Help:Specifies the desired os type for the build, each may support different os type, run 'hb build --target-os {os_type}' to set os type
[OHOS INFO]   -v {default}, --variant {default}
[OHOS INFO]                         Default:''. Help:install product variant, run 'hb build --variant {variant_name}'
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb install [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --part PART           Default:''. Help:specify package name, run 'hb install {package_name} or hb install --part {package_name}'
[OHOS INFO]   -g [GLOBAL], --global [GLOBAL]
[OHOS INFO]                         Default:false. Help:global install, run 'hb install {package_name} --global'
[OHOS INFO]   -l LOCAL, --local LOCAL
[OHOS INFO]                         Default:''. Help:install local package file, run 'hb install --local {package_path}'
[OHOS INFO]   -v {default}, --variant {default}
[OHOS INFO]                         Default:''. Help:install product variant, run 'hb install --variant {variant_name}'
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb package [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --part PART           Default:''. Help:specify component name, run 'hb package <part_name> or hb package --part <part_name>'
[OHOS INFO]   -o OUTPUT, --output OUTPUT
[OHOS INFO]                         Default:''. Help:specify the output directory, which is generated by default in the current directory
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb publish [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help   show this help message and exit
[OHOS INFO]   --part PART  Default:''. Help:specify component name, run 'hb publish {part_name} or hb publish --part {part_name}' to xxxxxx
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb update [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --part PART           Default:''. Help:specify component name, run 'hb update {part_name} or hb update --part {part_name}'
[OHOS INFO]   -g [GLOBAL], --global [GLOBAL]
[OHOS INFO]                         Default:false. Help:global update, run 'hb update {part_name} --global'
[OHOS INFO] ----------------------------------------------------------------------------------------------------
[OHOS INFO] usage: hb push [option]
[OHOS INFO] 
[OHOS INFO] options:
[OHOS INFO]   -h, --help            show this help message and exit
[OHOS INFO]   --part PART           Default:''. Help:specify component name, run 'hb push {part_name} or hb push --part {part_name}'
[OHOS INFO]   -t TARGET, --target TARGET
[OHOS INFO]                         Default:''. Help:specify target name, run 'hb push -t {target_number} or hb push --target {target_number}'
[OHOS INFO]   -l [LIST_TARGETS], --list-targets [LIST_TARGETS]
[OHOS INFO]                         Default:''. Help:list all target, run 'hb push --list-targets or hb push -l '
[OHOS INFO]   -s SRC, --src SRC     Default:''. Help:specify send file, run 'hb push --src or hb push -s'
[OHOS INFO]   -r [REBOOT], --reboot [REBOOT]
[OHOS INFO]                         Default:''. Help:reboot device, run 'hb push --reboot or hb push -r '

```

