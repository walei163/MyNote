# 网卡硬件流控设置

要使用 `ethtool` 打开网络硬件流控（即启用 `PAUSE` 帧流控），需要分别启用接收端（RX）和/或发送端（TX）的流控功能。

根据公开资料，流控功能可以通过 `ethtool -A` 命令进行配置。以下是具体操作步骤：

---

## 查看当前流控状态：

在修改之前，建议先查看网卡当前的流控设置，以确认当前状态：

```sh
ethtool -a <网卡接口名>
```

例如，如果网卡接口名为 eth0：

```sh
ethtool -a eth0
```

输出示例：

```sh
Pause parameters for eth0:
Autonegotiate:  off
RX:             off
TX:             off
```

**其中 RX 和 TX 分别表示接收端和发送端流控是否启用。**

---

## 启用网络硬件流控

要‌启用接收端和发送端流控‌，执行以下命令：

```sh
ethtool -A <网卡接口名> rx on tx on
```

例如：

```sh
ethtool -A eth0 rx on tx on
```

如果只想启用‌接收端流控‌（常用于防止接收缓冲区溢出）：

```sh
ethtool -A eth0 rx on
```

如果只想启用‌发送端流控‌：

```sh
ethtool -A eth0 tx on
```

> [!note]
>
> **‌注意‌：**
>
> **部分高端网卡（如华为 SP600 系列）支持更高级的基于优先级的流控（PFC），但 PFC 与传统的 PAUSE 帧流控互斥。如果 PFC 已启用，PAUSE 帧流控会自动关闭。可通过 `ethtool -a` 命令查看当前生效的流控类型。**

---

## 使配置永久生效

`ethtool` 的设置在重启后会失效。要使流控配置永久生效，可将命令添加到网络接口的配置文件中。

对于基于 `Red Hat/CentOS` 的系统（使用 `ifcfg` 配置文件）：

编辑网卡配置文件，例如：

```sh
sudo vi /etc/sysconfig/network-scripts/ifcfg-eth0
```

添加以下行：

```sh
ETHTOOL_OPTS="rx on tx on"
```

保存并重启网络服务或重启系统。
对于使用 `NetworkManager` 或 `netplan` 的现代系统，建议通过系统级网络配置工具进行持久化设置，或在启动脚本（如 `/etc/rc.local`）中添加命令。‌