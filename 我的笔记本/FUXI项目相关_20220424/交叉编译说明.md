# FUXI交叉编译说明

在对FUXI系统进行交叉编译时（以ntp-4.2.8p18为例），configure时会出现：

```sh
machine `csky‘ not recognized
```

说明脚本无法识别该体系架构，此时就需要用到`config.sub`文件。

修改`ntp-4.2.8p18_csky/sntp/libevent/build-aux/config.sub`文件，搜索如下字符串：

```sh
# Recognize the basic CPU types
```

一般在`config.sub`文件中会有3处，按照如下方式修改：

## 1、第一处：

```sh
# Some are omitted here because they have special meanings below.
1750a | 580 | csky \
```

## 2、第二处：

```sh
# Recognize the basic CPU types with company name.
580-* \
| csky-* \
```

## 3、第三处：

```sh
# Recognize the basic CPU types 
...

csky-*)
	basic_machine=FUXI-H2
	os=-linux
	;;
...

```

这样就把一个未知的架构加入到了configure配置脚本中了，然后可以进行configure配置，最后产生Makefile文件：

```sh
./configure --host=csky-linux-gnuabiv2 \
CC=csky-linux-gnuabiv2-gcc CXX=csky-linux-gnuabiv2-g++ CFLAGS="-mcpu=ck860fv -march=ck860v" \
--with-yielding-select=yes --without-crypto
```

> [!important]
>
> 在编译应用层的代码时，需要加上：
>
> ```sh
> CFLAGS="-mcpu=ck860fv -march=ck860v"
> ```
>
> 否则会导致程序运行出错。
