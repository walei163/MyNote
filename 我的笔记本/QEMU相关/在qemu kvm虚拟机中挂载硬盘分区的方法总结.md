# 在qemu kvm虚拟机中挂载硬盘分区的方法总结

转载注明：http://blog.csdn.net/hubbybob1/article/details/76889846

通过qemu创建的虚拟机之后想对虚拟机进行扩充或者添加几个新的硬盘，因此在此总结一下我尝试的方法，

## 方法一，通过对qemu的系统镜像直接扩充容量

```sh
qemu-img resize 你的镜像.img +10G
```

然后通过`qemu-system-x86_64`命令启动你的虚拟机（或者virsh），到磁盘管理下面，就可以看到有一个为初始化的磁盘，就可以分配给c盘。
这个方法就是给原有的img添加容量，在使用虚拟机的过程中如果镜像出问题，那么数据也会跟着丢失（如果没有快照的话）。因此下面几个方法，就脱离的系统镜像，直接挂载分区或者卷。

## 方法二、新建镜像或者本地分区直接加载

这个方法是两种操作，

### 一是利用qemu-img创建一个磁盘镜像，挂载到虚拟机里面去，

### 二是直接将本地的真实分区挂载进去

#### A。挂载真实分区，

在qemu-sys tem-x86_64启动虚拟机的命令里面直接添加参数

```sh
-hdb /dev/sda4  //不能使用hda，这个已经被虚拟机的系统盘使用，目前可以使用的是好的hdc hdd，在虚拟机内对应的就是D、E、F盘
```

启动虚拟机后，如果是第一次连接这个分区，则需要右击“我的电脑”-> “管理” -> “磁盘管理”，找到新建的磁盘，右击格式化，如下所示

![这里写图片描述](/media/sf_D_DRIVE/BaiduNetdiskWorkspace/VNote笔记本_20200401/我的笔记本/QEMU相关/images/SouthEast)

                            版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。

注意要使用NTFS格式记性格式化，这样windows和linux是兼容的，即同一个磁盘无论是在linux还是windows下操作的东西都能看的到
这样两边都可以使用这块分区了。也可以通过ssh远程挂载如下：

这种方法的缺点就是这块分区不能移动，因为是真实的分区，下面的方法就可以将创建的虚拟磁盘镜像随便移动到其他pc

#### B。创建虚拟磁盘镜像，这种方法类似上面的方法，就是创建一个img文件，方便移动。

```sh
qemu-img create -f qcow2 disk.img 10G //创建一个10G的虚拟磁盘镜像，只有真正用完10G，这个镜像的大小彩绘师10G
//或者
dd if=/dev/zero of=test.img bs=1M count 128
//bs=bytes #同时设置读写块的大小为 bytes ，可代替 ibs 和 obs 。
```


在虚拟机启动命令里面添加参数：

```sh
-hdc /你的路径/disk.img // hdb 已经被上面的方法用过了，因此此处就使用hdc
```


启动虚拟机加载硬盘的过程和上面的方法一样，请参考A
导致此虚拟机里面硬盘是整理好了，那么需要吧这个img文件挂载到本地才能在宿主机上使用，把创建好的disk.img文件进行本挂载和格式化

```sh
mkfs.ext3 -q disk.img //格式化为ext3的格式，不能是NTFS，会报错
mount -o loop disk.img /mnt  //这样就把disk.img挂载到mnt下面了
```


方法可以查看网址：http://blog.csdn.net/wh8_2011/article/details/51543755

————————————————

                            版权声明：本文为博主原创文章，遵循 CC 4.0 BY-SA 版权协议，转载请附上原文出处链接和本声明。

原文链接：https://blog.csdn.net/hubbybob1/article/details/76889846/