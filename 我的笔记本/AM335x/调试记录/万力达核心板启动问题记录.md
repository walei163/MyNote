# 万力达核心板启动问题记录

### 1. 故障现象：
核心板在上电时会卡在**SPL**打印的第一行信息上，此时如果按下复位键复位一下板卡，则系统可以正常启动。但是掉电后再上电启动，仍然会卡住。

### 2. 问题分析：
通过跟踪代码发现`U-boot`卡死在SPL启动时初始化`DDR3 SDRAM`阶段：
```
sdram_init();
```
经过仔细跟踪代码，并通过对比硬件原理图设计，发现硬件上给**DDR3 SDRAM**芯片供电的极个别**LDO**器件**TPS51200DRCT**在上电初始时输出的电压可能并不稳定，
结果会导致**SPL**启动代码在初始化**DDR3 SDRAM**的**PLL**时钟时，在读取状态值时陷入死循环中，从而卡死。

### 3. 解决方案：
在代码中，在进行配置**DDR3 SDRAM**之前，添加**<u>100毫秒</u>**的延时等待，目的是为了让**TPS51200DRCT**的输出稳定后再去配置**DDR3 SDRAM**。重新烧写**U-boot**，故障解决。

出现这样的现象，并不是普遍的，只是有极个别的TPS51200DRCT器件会出现。我司之前测试是按照万力达V800的烧写程序进行测试的，在测试过程中并未发现有此现象。

该现象的出现是在烧写万力达**WLD2660**终端烧写程序时发现的，由于**WLD2660**采用的是最新的**<u>Linux 4.19</u>**内核，匹配的是新版本的**<u>U-boot-2014.07-00107</u>**，新版本的U-boot代码因为引入了设备文件树（DTS）模式来支持硬件驱动，所以变动较大，估计在操作时序上和以前的代码有很多不同。

后续解决方案，我司之前测试是按照<u>**万力达V800**</u>的烧写程序进行测试的，后续统一改为按照**WLD2660**的烧写程序进行核心板的测试。
并统一按照添加了延时的**U-boot**方案进行测试，把问题杜绝在家里。